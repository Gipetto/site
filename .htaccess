Header set X-Frame-Options: DENY
Header set Strict-Transport-Security "max-age=31536000" env=HTTPS

php_value upload_max_file_size 2M
php_value post_max_size 2M
php_flag log_errors on
php_flag display_errors off
php_value error_reporting 32767

<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType application/pdf A31536000
ExpiresByType application/x-gzip A31536000
ExpiresByType application/x-javascript A31536000
ExpiresByType image/gif A31536000
ExpiresByType image/jpeg A31536000
ExpiresByType image/png A31536000
ExpiresByType image/svg+xml A31536000
ExpiresByType image/x-icon A31536000
ExpiresByType text/css A31536000
ExpiresByType text/html A3600
ExpiresByType application/x-font-ttf A31536000
ExpiresByType application/zip A31536000
</IfModule>

<FilesMatch "\.(js|html|css|svg)$">
    <IfModule mod_headers.c>
        Header set Pragma "public"
        Header append Cache-Control "public, must-revalidate, proxy-revalidate"
    </IfModule>
    FileETag None
    <IfModule mod_deflate.c>
        SetOutputFilter DEFLATE
        DeflateCompressionLevel 7
        DeflateMemLevel 8
        DeflateWindowSize 10
    </IfModule>
</FilesMatch>

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteCond %{REQUEST_URI} ^/video
RewriteRule . - [L,NC,QSA]

# catch avatar requests
RewriteCond %{REQUEST_URI} /avatar.png
RewriteRule ^(.*)? /avatar.php [L]

# catch old RSS feed url
RewriteCond %{REQUEST_URI} ^/rss
RewriteRule ^(.*)$ /feed [L,R=301]

# video token
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^token.* /token/index.php [L]
</IfModule>
